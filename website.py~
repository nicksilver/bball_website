from flask import Flask, render_template, g
import sqlite3
import datetime

app = Flask(__name__)
date = str(datetime.date.today())  # Get today's date

"""
See explanation for connection to a sqlite database at
http://opentechschool.github.io/python-flask/extras/databases.html
"""


@app.before_request  # Runs function before every request from browser
def before_request():
    # Connect to database
    g.db = sqlite3.connect("../stats.sqlite")


@app.teardown_request  # Closes the database connection after every request
def teardown_request(exception):
    if hasattr(g, 'db'):
        g.db.close()


@app.route('/')  # Routes method to home directory online
def emails():
    date_id = g.db.execute('''
        SELECT id
        FROM Dates
        WHERE date=?
        ''', (date, )).fetchone()[0]
    stats = g.db.execute('''
        SELECT THREES, AST, BLK, FG, FT, PTS, REB, STL, TOTAL
        FROM Change_stats
        WHERE date_id=?
        ''', (date_id, )).fetchall()
    return render_template('index.html', stats=stats)


if __name__ == '__main__':
    app.run()
